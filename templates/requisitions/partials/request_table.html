<table class="table table-striped table-hover align-middle mb-0 request-table">
  <thead>
    <tr>
      <th class="small" style="width:70px">ID</th>
      <th class="small" style="width:120px">User</th>
      {% if show_status %}<th class="small" style="width:110px">Status</th>{% endif %}
      <th class="small" style="width:140px">Submitted</th>
      <th class="small" style="min-width:220px">Items</th>
      <th class="small text-end" style="width:140px">Action</th>
    </tr>
  </thead>
  <tbody>
    {% for req in requests %}
    <tr>
      <td class="small">#{{ req.id }}</td>
      <td class="small">{{ req.user.username }}</td>
      {% if show_status %}
      <td class="small">
        <span class="badge badge-status {% if req.status == 'approved' %}badge-status-approved{% elif req.status == 'rejected' %}badge-status-rejected{% else %}badge-status-pending{% endif %}">{{ req.get_status_display }}</span>
      </td>
      {% endif %}
      <td class="small">{{ req.requested_at|date:'Y-m-d H:i' }}</td>
      <td style="word-break: break-word;">
        <ul class="mb-0 small" style="max-width: 280px;">
          {% for item in req.items.all %}
          <li>{{ item.quantity }} x {{ item.supply.name }}</li>
          {% endfor %}
        </ul>
      </td>
      <td class="text-end">
        {% if user.is_staff %}
        <div class="d-flex justify-content-end gap-1">
          <a class="btn btn-sm btn-outline-primary" href="{% url 'request_detail' req.id %}">Review</a>
          {% if req.status != 'pending' and not req.is_archived %}
          <form method="post" action="{% url 'archive_request' req.id %}">
            {% csrf_token %}
            <button class="btn btn-sm btn-outline-secondary" onclick="return confirm('Remove this request from active lists? It will remain in history.');">Remove</button>
          </form>
          {% endif %}
        </div>
        {% else %}
        <div class="d-flex justify-content-end gap-1">
          <span class="badge badge-status {% if req.status == 'approved' %}badge-status-approved{% elif req.status == 'rejected' %}badge-status-rejected{% else %}badge-status-pending{% endif %}">{{ req.get_status_display }}</span>
          {% if req.status == 'approved' %}
          <a class="btn btn-sm btn-outline-primary" href="{% url 'request_receipt' req.id %}" target="_blank">Receipt</a>
          {% endif %}
        </div>
        {% endif %}
      </td>
    </tr>
    {% empty %}
    <tr>
      <td colspan="{% if show_status %}6{% else %}5{% endif %}" class="text-center py-3 text-muted">{{ empty_msg }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<style>
  .request-table td, .request-table th { vertical-align: middle; }
  .request-table .badge-status { white-space: nowrap; }
  .request-table .btn { white-space: nowrap; }
</style>